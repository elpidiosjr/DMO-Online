<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Minha Conta - Digimon</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial;background:#091024;color:#fff;padding:18px}
    .list{max-width:840px;margin:18px auto}
    .card{background:rgba(255,255,255,0.03);padding:12px;border-radius:8px;margin-bottom:8px;display:flex;gap:12px;align-items:center}
    img{width:84px;height:84px;object-fit:contain;background:#fff;padding:6px;border-radius:6px}
    button{background:#06b6d4;border:none;padding:6px 8px;color:#012;border-radius:6px;cursor:pointer}
    .muted{color:#bbb}
  </style>
</head>
<body>
  <a href="index.html" style="color:#fff;text-decoration:none">‚Üê Voltar</a>
  <h1>Minha Conta</h1>
  <div class="muted">Digimon treinados (localStorage)</div>
  <div id="list" class="list">Carregando...</div>

<script>
  const API_URL = 'https://digimon-api.vercel.app/api/digimon';
  function getSavedMap(){ try{ const raw = localStorage.getItem('digimon_stats_v1'); return raw?JSON.parse(raw):{} }catch(e){return{}} }
  function removeAll(){ if(confirm('Limpar todos os dados de treino?')){ localStorage.removeItem('digimon_stats_v1'); render(); }}

  async function render(){
    const list = document.getElementById('list'); list.innerHTML='Carregando...';
    const map = getSavedMap(); const names = Object.keys(map);
    if(!names.length){ list.innerHTML = '<div class="muted">Nenhum Digimon treinado ainda.</div>'; return }

    // try fetch images
    let api = [];
    try{ const res = await fetch(API_URL); api = await res.json(); }catch(e){ console.warn('API',e) }

    list.innerHTML = '';
    names.forEach(name=>{
      const s = map[name];
      const dig = api.find(d => d.name.toLowerCase()===name.toLowerCase());
      const card = document.createElement('div'); card.className='card';
      card.innerHTML = `<img src="${dig?dig.img:''}" alt="${name}"><div style="flex:1"><div style="font-weight:700">${name}</div><div class="muted">‚öîÔ∏è ${s.atk} &nbsp; üõ°Ô∏è ${s.def} &nbsp; ‚ú® ${s.esp}</div></div><div style="display:flex;flex-direction:column;gap:8px"><a href="train.html?name=${encodeURIComponent(name)}" style="text-decoration:none"><button>Treinar</button></a><button data-remove="${name}">Remover</button></div>`;
      list.appendChild(card);
    });

    const clearAll = document.createElement('div'); clearAll.style.marginTop='12px'; clearAll.innerHTML = '<button id="clear-all" style="background:#ef4444">Limpar todos</button>';
    list.appendChild(clearAll);
    document.getElementById('clear-all').addEventListener('click', removeAll);

    // remove individual
    list.querySelectorAll('button[data-remove]').forEach(b=>b.addEventListener('click', ()=>{
      const name = b.getAttribute('data-remove'); const map = getSavedMap(); delete map[name]; localStorage.setItem('digimon_stats_v1', JSON.stringify(map)); render();
    }));
  }

  render();
</script>
</body>
</html>